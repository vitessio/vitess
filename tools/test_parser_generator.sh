#!/bin/sh
#
# Validate that the current version of the generated parser matches the output
# generated by the version of goyacc installed on the local system.
#
# This is used in travis to verify that the currently committed version was
# generated with the proper version of goyacc.

CUR="sql.go"
TMP="/tmp/sql.$$.go"

cd go/vt/sqlparser/

goyacc -o $TMP sql.y
gofmt -w $TMP

diff -q $CUR $TMP > /dev/null 2>&1

if [ $? != 0 ] ; then
        echo "ERROR: Regenerated parser $TMP does not match current version `pwd`/sql.go:"
        diff -u $CUR $TMP
        exit 1
fi

rm $TMP

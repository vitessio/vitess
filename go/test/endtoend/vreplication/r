cleanup() {
    rm -rf /Users/rohit/vtdataroot/*
    killall vtctldclient vtctld vttablet vtgate vtorc mysqlctl etcd
    ps | grep /vtdataroot | awk '{print $1}' | xargs kill -9
    ps x | grep mysql | grep -v grep | awk '{print $1}' | xargs kill -9


    rm -rf ~/vtdataroot/*
    mkdir -p ~/vtdataroot
    mkdir -p ~/vtdataroot/tmp
    mkdir -p ~/vtdataroot/ext
    mkdir -p ~/vtdataroot/ext/tmp
}

declare -a tests=("TestMaterializeVtctld")
declare -a tests=("TestMaterializeView")
declare -a tests=("TestMultiTenantSimple")
declare -a tests=("TestReferenceTableMaterialize")
declare -a tests=("WorkflowDuplicateKeyBackoff")
declare -a tests=("BasicVreplicationWorkflow")
declare -a tests=("CellAlias")
declare -a tests=("TestVSchemaChangesUnderLoad")
declare -a tests=("TestMoveTablesBuffering")
declare -a tests=("MigrateSharded")
declare -a tests=("CopyParallel")
declare -a tests=("TestWorkflowDuplicateKeyBackoff2")
declare -a tests=("TestMoveTablesBasic")
declare -a tests=("TestVtctldclientCLI")

declare -a tests=("TestBasicVreplicationWorkflow")
declare -a tests=("TestLookupVindex")
declare -a tests=("TestGlobalRouting")


export VREPLICATION_E2E_DEBUG=
export CI=true
for test in ${tests[@]}; do
    clear
    echo "================ Starting $test =============="
    echo
    cleanup
    go test -timeout 20m -failfast -v --alsologtostderr -run $test
    RET=$?
    echo "================ Done $test ================"
    echo
    say "$test done"
    exit $RET
done



create table user
(
    id   bigint,
    name varchar(255),
    primary key (id)
) Engine = InnoDB;

create table music
(
    id      bigint,
    user_id bigint,
    primary key (id)
) Engine = InnoDB;

insert into music(id, user_id)
values (1, 1),
       (2, 5),
       (3, 1),
       (4, 2),
       (5, 3),
       (6, 4),
       (7, 5);

insert into user(id, name)
values (1, 'toto'),
       (2, 'tata'),
       (3, 'titi'),
       (4, 'tete'),
       (5, 'foo');

# TestDerivedTableWithOrderByLimit
select music.id
from music
         join (select id, name from user order by id limit 2) as d on music.user_id = d.id;

# TestDerivedAggregationOnRHS
set sql_mode = '';
select d.a
from music
         join (select id, count(*) as a from user) as d on music.user_id = d.id
group by 1;

# TestDerivedRemoveInnerOrderBy
select count(*)
from (select user.id as oui, music.id as non
      from user
               join music on user.id = music.user_id
      order by user.name) as toto;

# TestDerivedTableColumns
SELECT t.id
FROM (SELECT id FROM user) AS t(id)
ORDER BY t.id DESC;

# TestDerivedTableColumnAliasWithJoin
SELECT user.id
FROM user
         join (SELECT id as uid FROM user) t on t.uid = user.id;
SELECT user.id
FROM user
         left join (SELECT id as uid FROM user) t on t.uid = user.id;
SELECT user.id
FROM user
         join (SELECT id FROM user) t(uid) on t.uid = user.id;
SELECT user.id
FROM user
         left join (SELECT id FROM user) t(uid) on t.uid = user.id;


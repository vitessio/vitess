<!DOCTYPE HTML>
<html lang="en">
<head>
  <title>DB topology</title>
  <style>
    .keyspace {
      font-family: monospace;
    }
    td {
      border: 1px solid black;
      vertical-align:text-top;
    }
    ul.tablet-list li {
      list-style-type: none;
      margin: 0px;
      position: relative;
    }
    ul.tablet-list {
    padding-left: 0px;
    }
    table.keyspace {
      border-collapse: collapse;
    }
    table.keyspace td {
      padding-left: 1em;
      padding-right: 1em;
    }
    .topo-link {
      vertical-align: super;
      font-size: 20%;
    }
    table.keyspace td.legend {
      text-align: center;
      padding-left: 1ex;
      padding-right: 1ex;
    }
    table.keyspace thead {
      text-align: center;
      border-color: #666;
      background-color: #dedede;
    }
    .not-replicating {
      text-decoration: line-through;
    }

  </style>
</head>
<body>
  {{with .Error}}
    <h1>{{.}}</h1>
  {{end}}
  {{with .Topology}}
    {{if .Partial}}
      <p><i><b>Warning:</b> This is a partial topology result, some cells are unavailable.</i></p>
    {{end}}
    <h2>ToC</h2>
    {{range $keyspace, $shards := .Assigned}}
      <li><a href="#keyspace_{{$keyspace}}">{{$keyspace}}</a></li>
    {{end}}

    <h1>Assigned</h1>
    {{range $keyspace, $shards := .Assigned}}
      <h2><a name="keyspace_{{$keyspace}}"></a>{{keyspace $keyspace}}</h2>
      <table class="keyspace">
	<thead>
	  {{ range $i, $shard := $shards.ShardNodes }}
	  {{if intequal $i 0}}<td class="legend">type</td>{{end}}
	  <td>{{shard $keyspace $shard.Name}}</td>
	  {{end}}
	</thead>
	<tbody>
	  {{range $processedType := $shards.TabletTypes}}

	  <tr>
	    {{range $i, $shard := $shards.ShardNodes}}
	    {{if intequal $i 0}}<td class="legend">{{$processedType}}</td>{{end}}
	    <td>
	      <ul class="tablet-list">
		{{range index $shard.TabletNodes $processedType}}
		  <li title="{{.Alias}}">{{tablet .Alias .ShortName}}</li>
		{{end}}
	      </ul>
	    </td>
	    {{end}}
	  </tr>
	  {{end}}
	</tbody>
      </table>
    {{end}}
    <h1>Idle</h1>
    <ul>
      {{range .Idle}}
        <li title="{{.Alias}}">{{tablet .Alias .ShortName}}</li>
      {{end}}
    </ul>
    <h1>Scrap</h1>
    <ul>
    {{range .Scrap}}
      <li title="{{.Alias}}">
        {{tablet .Alias .ShortName}} <a href="/tablet_actions?action=DeleteTablet&alias={{.Alias}}">(delete)</a>
      </li>
    {{end}}
    </ul>
  {{end}}

</body>
</html>

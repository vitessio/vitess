name: 'Setup Minio'
description: 'Set up Minio for use in GitHub Actions workflows'
runs:
  using: "composite"
  steps:
    - name: Cache minio package
      id: cache-minio
      uses: actions/cache@cdf6c1fa76f9f475f3d7449005a359c84ca0f306 # v5.0.3
      with:
        path: minio_20260202234011.0.0_amd64.deb
        key: minio_20260202234011.0.0_amd64.deb

    - name: Get Minio (on cache miss)
      if: steps.cache-minio.outputs.cache-hit != 'true'
      shell: bash
      run: |
        curl -sLo minio_20260202234011.0.0_amd64.deb.tmp https://dl.min.io/aistor/minio/release/linux-amd64/minio_20260202234011.0.0_amd64.deb

        # checksum - sha256sum source: https://dl.min.io/aistor/minio/release/linux-amd64/minio_20260202234011.0.0_amd64.deb.sha256sum
        sha256sum minio_20260202234011.0.0_amd64.deb.tmp | grep -q ^170ecb72f1a470c37e8bf9d839bde050bb919efdd0990c5d0a58c09b4667cc54
        [[ "$?" -eq 0 ]] && mv minio_20260202234011.0.0_amd64.deb.tmp minio_20260202234011.0.0_amd64.deb

    - name: Install Minio package
      shell: bash
      run: |
        sudo dpkg -i minio_20260202234011.0.0_amd64.deb
        sudo systemctl disable minio
        sudo systemctl stop minio

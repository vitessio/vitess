<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Vitess / Pivot Schema Changes</title>

        <!-- Webfont -->
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    
    <!--<link rel="shortcut icon" type="image/png" href="/favicon.png">-->

    <!-- Bootstrap -->
    <link href="/libs/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Styles -->
    <link rel="stylesheet" type="text/css" href="/css/site.css" />
    <!-- Font Awesome icons -->
    <link href="/libs/font-awesome-4.4.0/css/font-awesome.min.css"
          rel="stylesheet"
          type="text/css">
    
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/libs/bootstrap/js/bootstrap.min.js"></script>


    <!-- metadata -->
    <meta name="og:title" content="Vitess / Pivot Schema Changes"/>
    <meta name="og:image" content="/images/vitess_logomark_cropped.svg"/>
    <meta name="og:description" content="Vitess is a database clustering system for horizontal scaling of MySQL."/>

    <link rel="icon" href="/images/vitess_icon.png" type="image/png">

    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-60219601-1', 'auto');
  ga('send', 'pageview');
</script>

    
  </head>
  <body class="docs" id="top_of_page">

    <span id="toc-depth" data-toc-depth="h2,h3"></span>


    <nav id="common-nav" class="navbar navbar-fixed-top inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">
        <img class="logo" src="/images/vitess_logomark_cropped.svg" alt="Vitess">
      </a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right" id="standard-menu-links">
        <li><a href="/overview/">Overview</a></li>
        <li><a href="/user-guide/introduction.html">Guides</a></li>
        <li><a href="/reference/vitess-api.html">Reference</a></li>
        <li><a href="http://blog.vitess.io">Blog</a></li>
        <li><a href="https://github.com/youtube/vitess"><i class="fa fa-github"></i> GitHub</a></li>
        <!-- Hide link to blog unless we have actual posts -->
        <!-- <li><a href="/blog/" title="">Blog</a></li> -->
      </ul>
      <ul class="nav nav-stacked mobile-left-nav-menu" id="collapsed-left-menu">
                <li class="submenu">
          <h4 class="arrow-r no-top-margin">Overview</h4>
          <ul style="display: none">
            <li><a href="/overview/">What is Vitess</a></li>
            <li><a href="/overview/scaling-mysql.html">Scaling MySQL with Vitess</a></li>
            <li><a href="/overview/concepts.html">Key Concepts</a></li>
          </ul>
        </li>
        <li class="submenu">
          <h4 class="arrow-r">Getting Started</h4>
          <ul style="display: none">
            <li style="padding-bottom: 0"><a href="/getting-started/">Run Vitess on Kubernetes</a>
              <ul style="display: block">
                <li style="padding-bottom: 0"><a href="/getting-started/docker-build.html">Custom Docker Build</a></li>
              </ul>
            </li>
            <li><a href="/getting-started/local-instance.html">Run Vitess Locally</a></li>
          </ul>
        </li>
        <li class="submenu">
          <h4 class="arrow-r">User Guide</h4>
          <ul style="display: none">
            <li><a href="/user-guide/introduction.html">Introduction</a>
            <li><a href="/user-guide/client-libraries.html">Client Libraries</a>
            <li><a href="/user-guide/backup-and-restore.html">Backing Up Data</a>
            <li><a href="/user-guide/reparenting.html">Reparenting</a></li>
            <li style="padding-bottom: 0"><a href="/user-guide/schema-management.html">Schema Management</a></li>
              <ul style="display: block">
                <li style="padding-bottom: 0"><a href="/user-guide/pivot-schema-changes.html">Pivot Schema Changes (Tutorial)</a></li>
              </ul>
            <li style="padding-bottom: 0"><a href="/user-guide/sharding.html">Sharding</a>
              <ul style="display: block">
                <li><a href="/user-guide/horizontal-sharding.html">Horizontal Sharding (Codelab)</a></li>
                <li style="padding-bottom: 0"><a href="/user-guide/sharding-kubernetes.html">Sharding in Kubernetes (Codelab)</a></li>
              </ul>
            </li>
            <li><a href="/user-guide/vitess-replication.html">Vitess and Replication</a></li>
            <li><a href="/user-guide/topology-service.html">Topology Service</a></li>
            <li><a href="/user-guide/transport-security-model.html">Transport Security Model</a></li>
            <li style="padding-bottom: 0"><a href="/user-guide/launching.html">Launching</a>
              <ul style="display: block">
                <li><a href="/user-guide/scalability-philosophy.html">Scalability Philosophy</a></li>
                <li><a href="/user-guide/production-planning.html">Production Planning</a></li>
                <li><a href="/user-guide/server-configuration.html">Server Configuration</a></li>
                <li style="padding-bottom: 0"><a href="/user-guide/troubleshooting.html">Troubleshooting</a></li>
              </ul>
            </li>
            <li><a href="/user-guide/upgrading.html">Upgrading</a></li>
          </ul>
        </li>
        <li class="submenu">
          <h4 class="arrow-r">Reference Guides</h4>
          <ul style="display: none">
            <li><a href="/reference/vitess-api.html">Vitess API</a>
            <li><a href="/reference/vtctl.html">vtctl Commands</a>
          </ul>
        </li>
        <li class="submenu">
          <h4 class="arrow-r">Other Resources</h4>
          <ul style="display: none">
            <li><a href="/resources/presentations.html">Presentations</a>
            <li><a href="http://blog.vitess.io/">Blog</a>
          </ul>
        </li>
        <li class="submenu">
          <h4 class="arrow-r">Contributing</h4>
          <ul style="display: none">
            <li><a href="/contributing/">Contributing to Vitess</a>
            <li><a href="/contributing/github-workflow.html">GitHub Workflow</a>
            <li><a href="/contributing/code-reviews.html">Code Reviews</a>
          </ul>
        </li>

        <div>
          <form method="get" action="/search/">
            <input id="search-form" name="q" type="text" placeholder="Search">
          </form>
        </div>

        <li><a href="https://github.com/youtube/vitess" id="collapsed-left-menu-repo-link"><i class="fa fa-github"></i> GitHub</a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

    
<div id="masthead">
  <div class="container">
    <div class="row">
      <div class="col-md-9">
        <h1>Pivot Schema Changes</h1>
      </div>
    </div>
  </div>
</div>


<div class="container">
    <div class="row scroll-margin" id="toc-content-row">
    <div class="col-md-2" id="leftCol">
      <ul class="nav nav-stacked mobile-left-nav-menu" id="sidebar">
                <li class="submenu">
          <h4 class="arrow-r no-top-margin">Overview</h4>
          <ul style="display: none">
            <li><a href="/overview/">What is Vitess</a></li>
            <li><a href="/overview/scaling-mysql.html">Scaling MySQL with Vitess</a></li>
            <li><a href="/overview/concepts.html">Key Concepts</a></li>
          </ul>
        </li>
        <li class="submenu">
          <h4 class="arrow-r">Getting Started</h4>
          <ul style="display: none">
            <li style="padding-bottom: 0"><a href="/getting-started/">Run Vitess on Kubernetes</a>
              <ul style="display: block">
                <li style="padding-bottom: 0"><a href="/getting-started/docker-build.html">Custom Docker Build</a></li>
              </ul>
            </li>
            <li><a href="/getting-started/local-instance.html">Run Vitess Locally</a></li>
          </ul>
        </li>
        <li class="submenu">
          <h4 class="arrow-r">User Guide</h4>
          <ul style="display: none">
            <li><a href="/user-guide/introduction.html">Introduction</a>
            <li><a href="/user-guide/client-libraries.html">Client Libraries</a>
            <li><a href="/user-guide/backup-and-restore.html">Backing Up Data</a>
            <li><a href="/user-guide/reparenting.html">Reparenting</a></li>
            <li style="padding-bottom: 0"><a href="/user-guide/schema-management.html">Schema Management</a></li>
              <ul style="display: block">
                <li style="padding-bottom: 0"><a href="/user-guide/pivot-schema-changes.html">Pivot Schema Changes (Tutorial)</a></li>
              </ul>
            <li style="padding-bottom: 0"><a href="/user-guide/sharding.html">Sharding</a>
              <ul style="display: block">
                <li><a href="/user-guide/horizontal-sharding.html">Horizontal Sharding (Codelab)</a></li>
                <li style="padding-bottom: 0"><a href="/user-guide/sharding-kubernetes.html">Sharding in Kubernetes (Codelab)</a></li>
              </ul>
            </li>
            <li><a href="/user-guide/vitess-replication.html">Vitess and Replication</a></li>
            <li><a href="/user-guide/topology-service.html">Topology Service</a></li>
            <li><a href="/user-guide/transport-security-model.html">Transport Security Model</a></li>
            <li style="padding-bottom: 0"><a href="/user-guide/launching.html">Launching</a>
              <ul style="display: block">
                <li><a href="/user-guide/scalability-philosophy.html">Scalability Philosophy</a></li>
                <li><a href="/user-guide/production-planning.html">Production Planning</a></li>
                <li><a href="/user-guide/server-configuration.html">Server Configuration</a></li>
                <li style="padding-bottom: 0"><a href="/user-guide/troubleshooting.html">Troubleshooting</a></li>
              </ul>
            </li>
            <li><a href="/user-guide/upgrading.html">Upgrading</a></li>
          </ul>
        </li>
        <li class="submenu">
          <h4 class="arrow-r">Reference Guides</h4>
          <ul style="display: none">
            <li><a href="/reference/vitess-api.html">Vitess API</a>
            <li><a href="/reference/vtctl.html">vtctl Commands</a>
          </ul>
        </li>
        <li class="submenu">
          <h4 class="arrow-r">Other Resources</h4>
          <ul style="display: none">
            <li><a href="/resources/presentations.html">Presentations</a>
            <li><a href="http://blog.vitess.io/">Blog</a>
          </ul>
        </li>
        <li class="submenu">
          <h4 class="arrow-r">Contributing</h4>
          <ul style="display: none">
            <li><a href="/contributing/">Contributing to Vitess</a>
            <li><a href="/contributing/github-workflow.html">GitHub Workflow</a>
            <li><a href="/contributing/code-reviews.html">Code Reviews</a>
          </ul>
        </li>

        <div>
          <form method="get" action="/search/">
            <input id="search-form" name="q" type="text" placeholder="Search">
          </form>
        </div>

      </ul>
    </div>
    <div class="col-md-3" id="rightCol">
      <div class="nav nav-stacked" id="tocSidebar">
        <div id="toc"></div>
      </div>
    </div>
    <div class="col-md-7" id="centerCol">
      <div id="centerTextCol">
        <h1 id="pivot-schema-changes-a-tutorial">Pivot Schema Changes: A Tutorial</h1>

<p>This page describes how to apply long-running schema changes in Vitess/MySQL without disrupting ongoing operations. Examples for long-running changes on large databases are <code class="prettyprint">ALTER TABLE</code> (for example to add a column), <code class="prettyprint">OPTIMIZE TABLE</code> or large-scale data changes (e.g. populating a column or clearing out values).</p>

<p>If a schema change is not long-running, please use the simpler <a href="/user-guide/schema-management.html">vtctl ApplySchema</a> instead.</p>

<h2 id="overview">Overview</h2>

<p>One solution to realize such long-running schema changes is to use a temporary table and keep it in sync with triggers as <a href="http://code.openark.org/blog/mysql/online-alter-table-now-available-in-openark-kit">originally proposed by Shlomi</a> and further refined by others (<a href="https://www.percona.com/doc/percona-toolkit/2.2/pt-online-schema-change.html">Percona&#39;s pt-online-schema-change</a>, <a href="https://github.com/square/shift">Square&#39;s Shift</a>).</p>

<p>Here we describe an alternative solution which uses a combination of MySQL&#39;s statement based replication and backups to apply the changes to all tablets. Since the long-running schema changes are applied to an offline tablet, ongoing operations are not affected. Internally within Google this process is dubbed <strong>pivot</strong> and therefore we refer to it by this name throughout the document.</p>

<p>This tutorial outlines the necessary manual steps for a pivot and is based on the <a href="http://vitess.io/getting-started/">Vitess Kubernetes Getting Started Guide</a>. Eventually, we plan to provide an integrated solution within Vitess which will automate the steps for you.</p>

<p><strong>At the high level, a pivot comprises the following phases:</strong></p>

<ol>
<li>Apply the schema changes to an offline tablet.</li>
<li>Re-enable replication on the tablet, let it catch up and then create a backup of it.</li>
<li>Restore all remaining tablets (excluding the master) from the backup.</li>
<li>Failover the master to a replica tablet which has the new schema. Restore the old master from the backup.</li>
<li>At this point, all tablets have the new schema and you can start using it.</li>
</ol>

<p><strong>You may be wondering: Why does this work?</strong></p>

<p>The key here is that the new schema is backward compatible with respect to statements sent by the app. The replication stream remains backward compatible as well because we use statement based replication. As a consequence, the new schema must not be used until it has been changed on all tablets. If the schema would have been used e.g. when an insert uses a new column, replication would break on tablets which have the old schema. Pivoting all tablets first ensures this doesn&#39;t happen.</p>

<p>Also note that the changes are applied to only one tablet and then all other tablets are restored from the backup. This is more efficient than applying the long-running changes on every single tablet.</p>

<p>Now let&#39;s carry out an actual pivot based on our Guestbook example schema. We&#39;ll add a column to it.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>We assume that you have followed the <a href="http://vitess.io/getting-started/">Vitess Kubernetes Getting Started Guide</a> up to and including the step &quot;9. Create a table&quot;.</p>

<p>Furthermore, we assume that the tablet with the ID 100 is the current master.</p>

<h2 id="remarks">Remarks</h2>

<p>Note: The example uses the <code class="prettyprint">vtctl ExecuteFetchAsDba</code> command to read rows for demonstration purposes only. It is not recommended for daily operations since queries are executed with SUPER rights and e.g. can insert data on a read-only slave.</p>

<p>Throughout the tutorial many steps are marked as &quot;optional&quot; or meant for verification only (e.g. looking at the GTIDs with <code class="prettyprint">vtctl ShardReplicationPositions</code>). They are not relevant for the pivot process. However, they help to explain what is happening under the hood e.g. that a tablet did catch up to the latest GTID.</p>

<h2 id="pivot-steps">Pivot Steps</h2>

<h3 id="optional-insert-initial-data">Optional: Insert initial data</h3>

<p>Initially, the database will be empty. Let&#39;s insert one row. Let&#39;s also compare the executed GTIDs before and after the insert.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ShardReplicationPositions test_keyspace/0
Starting port forwarding to vtctld...
<span class="nb">test</span>-0000000103 test_keyspace <span class="m">0</span> rdonly 10.64.2.5:15002 10.64.2.5:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-7 0
<span class="nb">test</span>-0000000104 test_keyspace <span class="m">0</span> rdonly 10.64.1.3:15002 10.64.1.3:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-7 0
<span class="nb">test</span>-0000000102 test_keyspace <span class="m">0</span> replica 10.64.3.3:15002 10.64.3.3:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-7 0
<span class="nb">test</span>-0000000101 test_keyspace <span class="m">0</span> replica 10.64.0.6:15002 10.64.0.6:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-7 0
<span class="nb">test</span>-0000000100 test_keyspace <span class="m">0</span> master 10.64.4.5:15002 10.64.4.5:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-7 0
</code></pre></div>
<p>Before the insert, the highest executed GTID is 7.</p>

<p>Insert a row:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ExecuteFetchAsDba <span class="nb">test</span>-0000000100 <span class="s2">&quot;INSERT INTO messages (page, time_created_ns, message) VALUES (1, UNIX_TIMESTAMP(now()), &#39;before pivot&#39;)&quot;</span>
Starting port forwarding to vtctld...
+
+
</code></pre></div>
<p>Verify that it&#39;s there:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ExecuteFetchAsDba <span class="nb">test</span>-0000000104 <span class="s2">&quot;SELECT * FROM messages&quot;</span>
Starting port forwarding to vtctld...
+------+-----------------+--------------+
<span class="p">|</span> page <span class="p">|</span> time_created_ns <span class="p">|</span>   message    <span class="p">|</span>
+------+-----------------+--------------+
<span class="p">|</span>    <span class="m">1</span> <span class="p">|</span>      <span class="m">1464305998</span> <span class="p">|</span> before pivot <span class="p">|</span>
+------+-----------------+--------------+
</code></pre></div>
<p>Check the highest executed GTID:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ShardReplicationPositions test_keyspace/0
Starting port forwarding to vtctld...
<span class="nb">test</span>-0000000104 test_keyspace <span class="m">0</span> rdonly 10.64.1.3:15002 10.64.1.3:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-8 0
<span class="nb">test</span>-0000000103 test_keyspace <span class="m">0</span> rdonly 10.64.2.5:15002 10.64.2.5:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-8 0
<span class="nb">test</span>-0000000102 test_keyspace <span class="m">0</span> replica 10.64.3.3:15002 10.64.3.3:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-8 0
<span class="nb">test</span>-0000000101 test_keyspace <span class="m">0</span> replica 10.64.0.6:15002 10.64.0.6:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-8 0
<span class="nb">test</span>-0000000100 test_keyspace <span class="m">0</span> master 10.64.4.5:15002 10.64.4.5:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-8 0
</code></pre></div>
<p>The GTID increased by one from 7 to 8 and all replicas catched up to it.</p>

<h3 id="apply-the-schema-to-an-offline-tablet">Apply the schema to an offline tablet</h3>

<p>Let&#39;s take the <em>rdonly</em> tablet with the ID 104 offline and apply the changes there:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh StopSlave <span class="nb">test</span>-0000000104
Starting port forwarding to vtctld...
</code></pre></div>
<p>Note: If a vtctl command does not produce any output (like <code class="prettyprint">StopSlave</code>), it means that it succeeded.</p>

<p>Verify that replication is turned off:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ExecuteFetchAsDba <span class="nb">test</span>-0000000104 <span class="s2">&quot;SELECT SERVICE_STATE FROM performance_schema.replication_connection_status;&quot;</span>
Starting port forwarding to vtctld...
+---------------+
<span class="p">|</span> SERVICE_STATE <span class="p">|</span>
+---------------+
<span class="p">|</span> OFF           <span class="p">|</span>
+---------------+
</code></pre></div>
<p><code class="prettyprint">OFF</code> means the Slave IO thread has been stopped. The Slave SQL thread should have been turned off as well. (Replace <code class="prettyprint">connection</code> with <code class="prettyprint">applier</code> in the command above if you want to verify it.)</p>

<p>Now let&#39;s simulate that the application continues to make changes to the database while we change the schema.</p>

<p>Insert a second row on the master (ID 100). The offline tablet won&#39;t see this row:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ExecuteFetchAsDba <span class="nb">test</span>-0000000100 <span class="s2">&quot;INSERT INTO messages (page, time_created_ns, message) VALUES (2, UNIX_TIMESTAMP(now()), &#39;104 replication stopped&#39;)&quot;</span>
Starting port forwarding to vtctld...
+
+
</code></pre></div>
<p>The change has been propagated to an online <em>rdonly</em> tablet (ID 103):</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ExecuteFetchAsDba <span class="nb">test</span>-0000000103 <span class="s2">&quot;SELECT * FROM messages&quot;</span>
Starting port forwarding to vtctld...
+------+-----------------+-------------------------+
<span class="p">|</span> page <span class="p">|</span> time_created_ns <span class="p">|</span>         message         <span class="p">|</span>
+------+-----------------+-------------------------+
<span class="p">|</span>    <span class="m">1</span> <span class="p">|</span>      <span class="m">1464305998</span> <span class="p">|</span> before pivot            <span class="p">|</span>
<span class="p">|</span>    <span class="m">2</span> <span class="p">|</span>      <span class="m">1464306056</span> <span class="p">|</span> <span class="m">104</span> replication stopped <span class="p">|</span>
+------+-----------------+-------------------------+
</code></pre></div>
<p>Our offline <em>rdonly</em> tablet (ID 104) doesn&#39;t receive it as we turned replication off:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ExecuteFetchAsDba <span class="nb">test</span>-0000000104 <span class="s2">&quot;SELECT * FROM messages&quot;</span>
Starting port forwarding to vtctld...
+------+-----------------+--------------+
<span class="p">|</span> page <span class="p">|</span> time_created_ns <span class="p">|</span>   message    <span class="p">|</span>
+------+-----------------+--------------+
<span class="p">|</span>    <span class="m">1</span> <span class="p">|</span>      <span class="m">1464305998</span> <span class="p">|</span> before pivot <span class="p">|</span>
+------+-----------------+--------------+
</code></pre></div>
<p>We can also see that when we look at the executed GTIDs of all tablets:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ShardReplicationPositions test_keyspace/0
Starting port forwarding to vtctld...
<span class="nb">test</span>-0000000103 test_keyspace <span class="m">0</span> rdonly 10.64.2.5:15002 10.64.2.5:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9 0
<span class="nb">test</span>-0000000104 test_keyspace <span class="m">0</span> rdonly 10.64.1.3:15002 10.64.1.3:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-8 0
<span class="nb">test</span>-0000000101 test_keyspace <span class="m">0</span> replica 10.64.0.6:15002 10.64.0.6:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9 0
<span class="nb">test</span>-0000000102 test_keyspace <span class="m">0</span> replica 10.64.3.3:15002 10.64.3.3:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9 0
<span class="nb">test</span>-0000000100 test_keyspace <span class="m">0</span> master 10.64.4.5:15002 10.64.4.5:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9 0
</code></pre></div>
<p>Note that the tablet with the ID 104 is lagging behind by one transaction now (8 instead of 9) because we stopped replication on it.</p>

<p>Apply a schema change on the <em>rdonly</em> tablet. We&#39;ll add the column <code class="prettyprint">views</code> to the <code class="prettyprint">messages</code> table.</p>

<p>Since the tablet is a slave and read-only, we will have to use <code class="prettyprint">ExecuteFetchAsDba</code> to execute the SQL statement with SUPER rights.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ExecuteFetchAsDba -disable_binlogs <span class="nb">test</span>-0000000104 <span class="s2">&quot;ALTER TABLE messages ADD views BIGINT(20) UNSIGNED NULL&quot;</span>
Starting port forwarding to vtctld...
+
+
</code></pre></div>
<p>Let&#39;s check the highest GTID on each tablet.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ShardReplicationPositions test_keyspace/0
Starting port forwarding to vtctld...
<span class="nb">test</span>-0000000103 test_keyspace <span class="m">0</span> rdonly 10.64.2.5:15002 10.64.2.5:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9 0
<span class="nb">test</span>-0000000104 test_keyspace <span class="m">0</span> rdonly 10.64.1.3:15002 10.64.1.3:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-8 0
<span class="nb">test</span>-0000000101 test_keyspace <span class="m">0</span> replica 10.64.0.6:15002 10.64.0.6:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9 0
<span class="nb">test</span>-0000000102 test_keyspace <span class="m">0</span> replica 10.64.3.3:15002 10.64.3.3:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9 0
<span class="nb">test</span>-0000000100 test_keyspace <span class="m">0</span> master 10.64.4.5:15002 10.64.4.5:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9 0
</code></pre></div>
<p>During the pivot it&#39;s important that the schema change won&#39;t be added to the binlogs. Therefore, we ran ExecuteFetchAsDba with the <code class="prettyprint">-disable_binlogs</code> flags. If we don&#39;t skip the binlogs, we would create an alternate future on the offline tablet.</p>

<p>You can see that the schema change DDL was not added to the binlogs because the GTID did not increase on tablet 104 (it stayed at 8).</p>

<p>Verify that the schema has been changed:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ExecuteFetchAsDba <span class="nb">test</span>-0000000104 <span class="s2">&quot;SHOW COLUMNS FROM messages&quot;</span>
Starting port forwarding to vtctld...
+-----------------+---------------------+------+-----+---------+-------+
<span class="p">|</span>      Field      <span class="p">|</span>        Type         <span class="p">|</span> Null <span class="p">|</span> Key <span class="p">|</span> Default <span class="p">|</span> Extra <span class="p">|</span>
+-----------------+---------------------+------+-----+---------+-------+
<span class="p">|</span> page            <span class="p">|</span> bigint<span class="o">(</span>20<span class="o">)</span> unsigned <span class="p">|</span> NO   <span class="p">|</span> PRI <span class="p">|</span>         <span class="p">|</span>       <span class="p">|</span>
<span class="p">|</span> time_created_ns <span class="p">|</span> bigint<span class="o">(</span>20<span class="o">)</span> unsigned <span class="p">|</span> NO   <span class="p">|</span> PRI <span class="p">|</span>         <span class="p">|</span>       <span class="p">|</span>
<span class="p">|</span> message         <span class="p">|</span> varchar<span class="o">(</span>10000<span class="o">)</span>      <span class="p">|</span> YES  <span class="p">|</span>     <span class="p">|</span>         <span class="p">|</span>       <span class="p">|</span>
<span class="p">|</span> views           <span class="p">|</span> bigint<span class="o">(</span>20<span class="o">)</span> unsigned <span class="p">|</span> YES  <span class="p">|</span>     <span class="p">|</span>         <span class="p">|</span>       <span class="p">|</span>
+-----------------+---------------------+------+-----+---------+-------+
</code></pre></div>
<h3 id="re-enable-replication-on-the-offline-tablet">Re-enable replication on the offline tablet</h3>

<p>Before we create the backup, we&#39;ll restart replication first and let the tablet catch up. This way, we minimize the number of new ongoing writes which won&#39;t be in the backup and have to be applied after the restore.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh StartSlave <span class="nb">test</span>-0000000104
Starting port forwarding to vtctld...
</code></pre></div>
<p>Verify that replication is running again:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ExecuteFetchAsDba <span class="nb">test</span>-0000000104 <span class="s2">&quot;SELECT SERVICE_STATE FROM performance_schema.replication_connection_status;&quot;</span>
Starting port forwarding to vtctld...
+---------------+
<span class="p">|</span> SERVICE_STATE <span class="p">|</span>
+---------------+
<span class="p">|</span> ON            <span class="p">|</span>
+---------------+
</code></pre></div>
<p>Once tablet 104 has caught up, it should include the second row as well:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ExecuteFetchAsDba <span class="nb">test</span>-0000000104 <span class="s2">&quot;SELECT * FROM messages&quot;</span>
Starting port forwarding to vtctld...
+------+-----------------+-------------------------+-------+
<span class="p">|</span> page <span class="p">|</span> time_created_ns <span class="p">|</span>         message         <span class="p">|</span> views <span class="p">|</span>
+------+-----------------+-------------------------+-------+
<span class="p">|</span>    <span class="m">1</span> <span class="p">|</span>      <span class="m">1464305998</span> <span class="p">|</span> before pivot            <span class="p">|</span>       <span class="p">|</span>
<span class="p">|</span>    <span class="m">2</span> <span class="p">|</span>      <span class="m">1464306056</span> <span class="p">|</span> <span class="m">104</span> replication stopped <span class="p">|</span>       <span class="p">|</span>
+------+-----------------+-------------------------+-------+
</code></pre></div>
<p>Note it includes our newly added column <code class="prettyprint">views</code> and the second row as well.</p>

<p>When we check the executed GTIDs, we also see that tablet 104 has caught up:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ShardReplicationPositions test_keyspace/0
Starting port forwarding to vtctld...
<span class="nb">test</span>-0000000104 test_keyspace <span class="m">0</span> rdonly 10.64.1.3:15002 10.64.1.3:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9 0
<span class="nb">test</span>-0000000103 test_keyspace <span class="m">0</span> rdonly 10.64.2.5:15002 10.64.2.5:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9 0
<span class="nb">test</span>-0000000101 test_keyspace <span class="m">0</span> replica 10.64.0.6:15002 10.64.0.6:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9 0
<span class="nb">test</span>-0000000102 test_keyspace <span class="m">0</span> replica 10.64.3.3:15002 10.64.3.3:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9 0
<span class="nb">test</span>-0000000100 test_keyspace <span class="m">0</span> master 10.64.4.5:15002 10.64.4.5:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9 0
</code></pre></div>
<h3 id="create-a-backup-of-the-offline-tablet">Create a backup of the offline tablet</h3>

<p>Now we&#39;ll create a backup of the tablet which has the schema change and restore the other tablets from this backup:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh Backup <span class="nb">test</span>-0000000104
Starting port forwarding to vtctld...
</code></pre></div>
<p>When the command returns, the backup will be available:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ListBackups test_keyspace/0
Starting port forwarding to vtctld...
2016-05-27.001231.test-0000000104
</code></pre></div>
<h3 id="restore-the-slave-tablets-from-the-backup">Restore the slave tablets from the backup</h3>

<p>We restore the tablets from the backup by restarting them. Since the Kubernetes pods lose their state after a shutdown, they&#39;ll always restore from the latest backup and then connect to the master to catch up on changes which were made after the backup was taken.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>kubectl delete pod vttablet-103
pod <span class="s2">&quot;vttablet-103&quot;</span> deleted
</code></pre></div>
<p>Note that the shutdown will take several seconds. While it&#39;s shutting down, Kubernetes tracks its state as <code class="prettyprint">Terminating</code>:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>kubectl get pods
...
vttablet-103        2/2       Terminating   <span class="m">1</span>          18m
...
</code></pre></div>
<p>Once it&#39;s gone, you can restart it:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ TASKS</span><span class="o">=</span><span class="m">3</span> ./vttablet-up.sh
Creating test_keyspace.shard-0 pods in cell test...
Creating pod <span class="k">for</span> tablet <span class="nb">test</span>-0000000103...
pod <span class="s2">&quot;vttablet-103&quot;</span> created
</code></pre></div>
<p>The restore from backup will take several seconds. While a tablet is restoring, Vitess tracks its state as <code class="prettyprint">restore</code>: </p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ListAllTablets <span class="nb">test</span>
Starting port forwarding to vtctld...
...
<span class="nb">test</span>-0000000103 test_keyspace <span class="m">0</span> restore 10.64.2.5:15002 10.64.2.5:3306 <span class="o">[]</span>
...
</code></pre></div>
<p>Eventually, you can query the restarted tablet and check if it has the added column as well.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ExecuteFetchAsDba <span class="nb">test</span>-0000000103 <span class="s2">&quot;SELECT * FROM messages&quot;</span>
Starting port forwarding to vtctld...
+------+-----------------+-------------------------+-------+
<span class="p">|</span> page <span class="p">|</span> time_created_ns <span class="p">|</span>         message         <span class="p">|</span> views <span class="p">|</span>
+------+-----------------+-------------------------+-------+
<span class="p">|</span>    <span class="m">1</span> <span class="p">|</span>      <span class="m">1464305998</span> <span class="p">|</span> before pivot            <span class="p">|</span>       <span class="p">|</span>
<span class="p">|</span>    <span class="m">2</span> <span class="p">|</span>      <span class="m">1464306056</span> <span class="p">|</span> <span class="m">104</span> replication stopped <span class="p">|</span>       <span class="p">|</span>
+------+-----------------+-------------------------+-------+
</code></pre></div>
<p>Now repeat the process for the remaining two <em>replica</em> tablets:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>kubectl delete pod vttablet-102
vitess/examples/kubernetes<span class="nv">$ TASKS</span><span class="o">=</span><span class="m">2</span> ./vttablet-up.sh
</code></pre></div><div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>kubectl delete pod vttablet-101
vitess/examples/kubernetes<span class="nv">$ TASKS</span><span class="o">=</span><span class="m">1</span> ./vttablet-up.sh
</code></pre></div>
<p>We recommend to restart at most one or two tablets simultaneously to not impact the overall availability of the system. (For example, be aware that an emergency failover of the master might happen during the restarts.)</p>

<h3 id="restore-the-master-tablet-from-the-backup">Restore the master tablet from the backup</h3>

<p>To recap: tablet 100 is the current master and was not restored yet. All other tablets have already been restored. You can verify this with the <code class="prettyprint">ListAllTablets</code> command:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ListAllTablets <span class="nb">test</span>
Starting port forwarding to vtctld...
<span class="nb">test</span>-0000000100 test_keyspace <span class="m">0</span> master 10.64.4.5:15002 10.64.4.5:3306 <span class="o">[]</span>
<span class="nb">test</span>-0000000101 test_keyspace <span class="m">0</span> replica 10.64.0.6:15002 10.64.0.6:3306 <span class="o">[]</span>
<span class="nb">test</span>-0000000102 test_keyspace <span class="m">0</span> replica 10.64.3.3:15002 10.64.3.3:3306 <span class="o">[]</span>
<span class="nb">test</span>-0000000103 test_keyspace <span class="m">0</span> rdonly 10.64.2.5:15002 10.64.2.5:3306 <span class="o">[]</span>
<span class="nb">test</span>-0000000104 test_keyspace <span class="m">0</span> rdonly 10.64.1.3:15002 10.64.1.3:3306 <span class="o">[]</span>
</code></pre></div>
<p>To restore tablet 100 as well, we&#39;ll failover the master to tablet 101 first:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh PlannedReparentShard test_keyspace/0 <span class="nb">test</span>-0000000101
Starting port forwarding to vtctld...
</code></pre></div>
<p><code class="prettyprint">ListAllTablets</code> will show that tablet 101 is the new master.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ListAllTablets <span class="nb">test</span>
Starting port forwarding to vtctld...
<span class="nb">test</span>-0000000100 test_keyspace <span class="m">0</span> replica 10.64.4.5:15002 10.64.4.5:3306 <span class="o">[]</span>
<span class="nb">test</span>-0000000101 test_keyspace <span class="m">0</span> master 10.64.0.6:15002 10.64.0.6:3306 <span class="o">[]</span>
<span class="nb">test</span>-0000000102 test_keyspace <span class="m">0</span> replica 10.64.3.3:15002 10.64.3.3:3306 <span class="o">[]</span>
<span class="nb">test</span>-0000000103 test_keyspace <span class="m">0</span> rdonly 10.64.2.5:15002 10.64.2.5:3306 <span class="o">[]</span>
<span class="nb">test</span>-0000000104 test_keyspace <span class="m">0</span> rdonly 10.64.1.3:15002 10.64.1.3:3306 <span class="o">[]</span>
</code></pre></div>
<p>When we check the GTIDs, we can see that the highest GTID for the new master is 3:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ShardReplicationPositions test_keyspace/0
Starting port forwarding to vtctld...
<span class="nb">test</span>-0000000103 test_keyspace <span class="m">0</span> rdonly 10.64.2.5:15002 10.64.2.5:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9,c3de87c6-239a-11e6-a20e-02420a400006:1-3 0
<span class="nb">test</span>-0000000104 test_keyspace <span class="m">0</span> rdonly 10.64.1.3:15002 10.64.1.3:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9,c3de87c6-239a-11e6-a20e-02420a400006:1-3 0
<span class="nb">test</span>-0000000100 test_keyspace <span class="m">0</span> replica 10.64.4.5:15002 10.64.4.5:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9,c3de87c6-239a-11e6-a20e-02420a400006:1-3 0
<span class="nb">test</span>-0000000102 test_keyspace <span class="m">0</span> replica 10.64.3.3:15002 10.64.3.3:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9,c3de87c6-239a-11e6-a20e-02420a400006:1-3 0
<span class="nb">test</span>-0000000101 test_keyspace <span class="m">0</span> master 10.64.0.6:15002 10.64.0.6:3306 <span class="o">[]</span> MySQL56/c2f5cc53-239a-11e6-a17b-02420a400405:1-9,c3de87c6-239a-11e6-a20e-02420a400006:1-3 0
</code></pre></div>
<p>You see that the list of GTIDs has one more entry because the master has changed.</p>

<p><strong>Note:</strong> There is currently a known issue that a vttablet does not properly restore from a backup when a reparent happened in the meantime. To work around the issue, you&#39;ll have to create a new backup after the reparent to the new master.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh Backup <span class="nb">test</span>-0000000104
Starting port forwarding to vtctld...
</code></pre></div>
<p>Now restart the old master:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>kubectl delete pod vttablet-100
vitess/examples/kubernetes<span class="nv">$ TASKS</span><span class="o">=</span><span class="m">0</span> ./vttablet-up.sh
</code></pre></div>
<p>Once the old master restored, all tablets have been changed to the new schema and we can start using it.</p>

<h3 id="use-the-new-schema">Use the new schema</h3>

<p>At this point, you can change your application to use the new schema. We simulate this by inserting a third row which references the newly added column <code class="prettyprint">views</code>:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ExecuteFetchAsDba <span class="nb">test</span>-0000000101 <span class="s2">&quot;INSERT INTO messages (page, time_created_ns, message, views) VALUES (3, UNIX_TIMESTAMP(now()), &#39;after pivot&#39;, 301)&quot;</span>
Starting port forwarding to vtctld...
+
+
</code></pre></div>
<p>The row will be replicated to all tablets e.g. the old master:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ExecuteFetchAsDba <span class="nb">test</span>-0000000100 <span class="s2">&quot;SELECT * FROM messages&quot;</span>
Starting port forwarding to vtctld...
+------+-----------------+-------------------------+-------+
<span class="p">|</span> page <span class="p">|</span> time_created_ns <span class="p">|</span>         message         <span class="p">|</span> views <span class="p">|</span>
+------+-----------------+-------------------------+-------+
<span class="p">|</span>    <span class="m">1</span> <span class="p">|</span>      <span class="m">1464823680</span> <span class="p">|</span> before pivot            <span class="p">|</span>       <span class="p">|</span>
<span class="p">|</span>    <span class="m">2</span> <span class="p">|</span>      <span class="m">1464823795</span> <span class="p">|</span> <span class="m">104</span> replication stopped <span class="p">|</span>       <span class="p">|</span>
<span class="p">|</span>    <span class="m">3</span> <span class="p">|</span>      <span class="m">1464824695</span> <span class="p">|</span> after pivot             <span class="p">|</span>   <span class="m">301</span> <span class="p">|</span>
+------+-----------------+-------------------------+-------+
</code></pre></div>
<p>The highest executed GTID was increased accordingly on all tablets from 3 to 4:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">vitess/examples/kubernetes<span class="nv">$ </span>./kvtctl.sh ShardReplicationPositions test_keyspace/0
Starting port forwarding to vtctld...
<span class="nb">test</span>-0000000104 test_keyspace <span class="m">0</span> rdonly 10.64.1.3:15002 10.64.1.3:3306 <span class="o">[]</span> MySQL56/5347b3ed-2850-11e6-92a9-02420a400405:1-9,f20c5e25-2851-11e6-bb74-02420a400006:1-4 0
<span class="nb">test</span>-0000000103 test_keyspace <span class="m">0</span> rdonly 10.64.2.5:15002 10.64.2.5:3306 <span class="o">[]</span> MySQL56/5347b3ed-2850-11e6-92a9-02420a400405:1-9,f20c5e25-2851-11e6-bb74-02420a400006:1-4 0
<span class="nb">test</span>-0000000102 test_keyspace <span class="m">0</span> replica 10.64.3.3:15002 10.64.3.3:3306 <span class="o">[]</span> MySQL56/5347b3ed-2850-11e6-92a9-02420a400405:1-9,f20c5e25-2851-11e6-bb74-02420a400006:1-4 0
<span class="nb">test</span>-0000000100 test_keyspace <span class="m">0</span> replica 10.64.4.5:15002 10.64.4.5:3306 <span class="o">[]</span> MySQL56/5347b3ed-2850-11e6-92a9-02420a400405:1-9,f20c5e25-2851-11e6-bb74-02420a400006:1-4 0
<span class="nb">test</span>-0000000101 test_keyspace <span class="m">0</span> master 10.64.0.6:15002 10.64.0.6:3306 <span class="o">[]</span> MySQL56/5347b3ed-2850-11e6-92a9-02420a400405:1-9,f20c5e25-2851-11e6-bb74-02420a400006:1-4 0
</code></pre></div>
      </div>
    </div>
  </div>

</div>

    <div class="page-spacer"></div>
    <footer role="contentinfo" id="site-footer">
  <nav role="navigation" class="menu bottom-menu">
    
    <a href="https://groups.google.com/forum/#!forum/vitess" target="_blank">Contact: vitess@googlegroups.com</a>&nbsp;&nbsp;<b>·</b>&nbsp;&nbsp;
    <a href="https://groups.google.com/forum/#!forum/vitess-announce" target="_blank">Announcements</a>&nbsp;&nbsp;<b>·</b>&nbsp;&nbsp;
    &#169; 2016 <a href="/">Vitess</a> powered by <a href="https://developers.google.com/open-source/">Google Inc</a>
  </nav>
</footer>


        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<!--    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>   -->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
<!--
    <script src="/libs/bootstrap/js/bootstrap.min.js"></script>
-->
    <!-- Include the common site javascript -->
    <script src="/js/common.js" type="text/javascript" charset="utf-8"></script>


  </body>
</html>
